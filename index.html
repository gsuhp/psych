<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Clinical Tools For Education</title>

<!-- jsPDF (UMD) -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
  :root{--bg:#f7f8fb;--card:#fff;--muted:#6b7280;--accent:#1f2937}
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:#111}
  .wrap{max-width:980px;margin:18px auto;padding:18px;}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
  .brand{font-size:20px;font-weight:700;color:var(--accent)}
  .nav{display:flex;gap:8px}
  .nav button{background:transparent;border:1px solid transparent;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .nav button.active{background:var(--accent);color:#fff}
  .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 8px 20px rgba(15,23,42,0.06);border:1px solid #e6eef8}
  label{display:block;margin-top:12px;font-weight:700}
  input[type="text"], input[type="number"], input[type="date"], select, textarea {
    width:100%; padding:10px; margin-top:6px; border-radius:8px; border:1px solid #d1d5db; box-sizing:border-box; font-weight:700;
  }
  textarea{min-height:80px; resize:vertical}
  .row{display:flex;gap:12px}
  .col-1{flex:0 0 120px}
  .col-flex{flex:1}
  .small{font-size:12px;color:var(--muted);margin-left:6px;font-weight:400}
  .controls{display:flex;gap:8px;margin-top:12px}
  button.primary{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:700}
  button.ghost{background:transparent;border:1px solid #d1d5db;padding:10px 14px;border-radius:8px;cursor:pointer}
  .logout{background:#b33;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
  pre#output{background:#fafafa;padding:12px;border-radius:8px;border:1px solid #eee;margin-top:14px;white-space:pre-wrap}
  .login-wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);z-index:999}
  .login-card{width:360px;background:var(--card);padding:20px;border-radius:12px;box-shadow:0 12px 40px rgba(2,6,23,0.2)}
  .login-card h2{text-align:center;margin:0 0 12px;font-size:18px}
  .meta{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}
  @media (max-width:760px){ .row{flex-direction:column} .col-1{flex:auto} }
  a.linkish{color:var(--accent);text-decoration:underline;cursor:pointer;font-weight:700}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="login-wrap" aria-hidden="false">
  <div class="login-card" role="dialog" aria-label="Site login">
    <h2>Protected Access</h2>
    <label for="loginUser">Username</label>
    <input id="loginUser" type="text" autocomplete="username" placeholder="Enter username">
    <label for="loginPass" style="margin-top:10px">Password</label>
    <input id="loginPass" type="password" autocomplete="current-password" placeholder="Enter password">
    <div style="display:flex;gap:8px;margin-top:12px;">
      <button id="loginBtn" class="primary" style="flex:1">Sign in</button>
    </div>
    <div style="display:flex;justify-content:space-between;margin-top:10px;align-items:center">
      <div class="meta">Client-side authentication only.</div>
      <a id="forgotLink" class="linkish" aria-label="Forgot password">Forgot?</a>
    </div>
  </div>
</div>

<!-- APP -->
<div id="app" class="wrap" style="display:none">
  <div class="topbar">
    <div class="brand">Clinical Tools For Education</div>
    <div style="display:flex;align-items:center;gap:12px">
      <div class="nav" role="navigation" aria-label="Form switch">
        <button id="btnGAD" class="active">GAD-7</button>
        <button id="btnPHQ">PHQ-A</button>
        <button id="btnDoctor">Doctor's Note</button>
      </div>
      <button id="logout" class="logout">Log out</button>
      <!-- Clock -->
      <button id="clockInBtn" class="ghost">Clock In</button>
      <button id="clockOutBtn" class="ghost">Clock Out</button>
      <div id="clockStatus" class="small" style="margin-left:6px">Not clocked in</div>
    </div>
  </div>

  <!-- FORMS (GAD, PHQ, Doctor) -->
  <!-- Include all GAD, PHQ, Doctor form HTML here exactly as before -->
</div>

<script>
/* ---------- Accounts & Access ---------- */
const ACCOUNTS = {
  'nmccgsuh': { pw:'15358', provider: 'Dr. Nicolas McCarthy MD PhD FACS', access: {gad:true, phq:true, doc:true} },
  'mjohn':    { pw:'mj15358', provider: 'Dr. Martha Johnson DO', access: {gad:true, phq:true, doc:true} },
  'psych':    { pw:'psychgsuh', provider: null, access: {gad:true, phq:true, doc:false} },
  'doctor':   { pw:'doctor', provider: null, access: {gad:false, phq:false, doc:true} }
};
const FORGOT_CODE = 'gsuhpsychteam';

/* ----- Elements ----- */
const loginWrap = document.getElementById('login');
const loginUser = document.getElementById('loginUser');
const loginPass = document.getElementById('loginPass');
const loginBtn = document.getElementById('loginBtn');
const forgotLink = document.getElementById('forgotLink');
const app = document.getElementById('app');
const logoutBtn = document.getElementById('logout');

const btnGAD = document.getElementById('btnGAD');
const btnPHQ = document.getElementById('btnPHQ');
const btnDoctor = document.getElementById('btnDoctor');

const gadCard = document.getElementById('gadCard');
const phqCard = document.getElementById('phqCard');
const doctorCard = document.getElementById('doctorCard');

/* ----- Login / Session ----- */
function showLogin(){ loginWrap.style.display='flex'; app.style.display='none'; loginWrap.setAttribute('aria-hidden','false'); loginUser.focus(); }
function showAppFor(user){
  loginWrap.style.display='none'; app.style.display='block'; loginWrap.setAttribute('aria-hidden','true');
  const access = ACCOUNTS[user].access;
  btnGAD.style.display = access.gad ? 'inline-block' : 'none';
  btnPHQ.style.display = access.phq ? 'inline-block' : 'none';
  btnDoctor.style.display = access.doc ? 'inline-block' : 'none';
  if(access.gad) selectTab('gad');
  else if(access.phq) selectTab('phq');
  else selectTab('doc');
  autofillProviderFor(user);
}

function authenticate(){
  const u = (loginUser.value||'').trim();
  const p = (loginPass.value||'').trim();
  if(!u){ alert('Enter username'); loginUser.focus(); return; }
  const acct = ACCOUNTS[u];
  if(acct && acct.pw === p){
    sessionStorage.setItem('psych_user', u);
    loginUser.value=''; loginPass.value='';
    showAppFor(u);
  } else {
    alert('Incorrect username or password.');
  }
}

function forgotFlow(){
  const u = (loginUser.value||'').trim();
  if(!u){ alert('Enter username first'); loginUser.focus(); return; }
  if(!ACCOUNTS[u]){ alert('Unknown username'); return; }
  const ans = prompt('Code?');
  if(ans === null) return;
  if(ans === FORGOT_CODE){
    sessionStorage.setItem('psych_user', u);
    loginUser.value=''; loginPass.value='';
    showAppFor(u);
  } else alert('Incorrect code.');
}

function autofillProviderFor(username){
  const mapping = ACCOUNTS[username];
  if(!mapping) return;
  const prov = mapping.provider;
  const gprov = document.getElementById('gad_provider');
  const pprov = document.getElementById('phq_provider');
  const dprov = document.getElementById('doc_provider');
  if(prov){
    if(gprov) gprov.value = prov;
    if(pprov) pprov.value = prov;
    if(dprov) dprov.value = prov;
  } else {
    if(gprov) gprov.value = '';
    if(pprov) pprov.value = '';
    if(dprov) dprov.value = '';
  }
}

loginBtn.addEventListener('click', authenticate);
forgotLink.addEventListener('click', forgotFlow);
loginPass.addEventListener('keydown', e=>{ if(e.key==='Enter') authenticate(); });
loginUser.addEventListener('keydown', e=>{ if(e.key==='Enter') loginPass.focus(); });

logoutBtn.addEventListener('click', ()=>{
  sessionStorage.removeItem('psych_user');
  showLogin();
});

/* ----- Tabs ----- */
function selectTab(which){
  btnGAD.classList.remove('active'); btnPHQ.classList.remove('active'); btnDoctor.classList.remove('active');
  gadCard.style.display='none'; phqCard.style.display='none'; doctorCard.style.display='none';
  if(which==='gad'){ btnGAD.classList.add('active'); gadCard.style.display='block'; }
  if(which==='phq'){ btnPHQ.classList.add('active'); phqCard.style.display='block'; }
  if(which==='doc'){ btnDoctor.classList.add('active'); doctorCard.style.display='block'; }
}

btnGAD.addEventListener('click', ()=>selectTab('gad'));
btnPHQ.addEventListener('click', ()=>selectTab('phq'));
btnDoctor.addEventListener('click', ()=>selectTab('doc'));
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Psych RP Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body { font-family: sans-serif; background: #f9f9f9; padding: 20px; color: #222; }
h1 { text-align: center; font-weight: bold; font-size: 32px; margin-bottom: 20px; }
label { display: block; margin-top: 12px; font-weight: bold; }
input, textarea, select, button { width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border:1px solid #ccc; box-sizing:border-box; font-weight:bold; }
button { background:#333; color:#fff; cursor:pointer; }
button:hover { background:#555; }
.tab { display: none; }
.tabs button { width: 49%; display: inline-block; margin-top:10px; }
#output { white-space: pre-wrap; margin-top:12px; border:1px solid #ccc; padding:8px; background:#fff; border-radius:5px; }
.small { font-size:12px; color:#666; }
</style>
</head>
<body>

<script>
alert("Disclaimer: This is not a real psychiatric center. No real patient data or PHI is recorded. For roleplay use only.");
</script>

<div id="loginDiv">
<h1>Login</h1>
<label>Username:</label>
<input type="text" id="username">
<label>Password:</label>
<input type="password" id="password">
<button onclick="login()">Login</button>
</div>

<div id="mainDiv" style="display:none;">
<h1>Psych RP Tool</h1>

<div class="tabs">
<button onclick="showTab('phq')">PHQ-9-A</button>
<button onclick="showTab('gad')">GAD-7</button>
</div>

<div id="phq" class="tab">
<label>Patient Name:</label><input type="text" id="phqName">
<label>Age:</label><input type="number" id="phqAge" min="0" max="120">
<label>PHQ-9-A Score:</label><input type="number" id="phqScore" min="0" max="27">
<label class="small">Auto severity updates</label>
<select id="phqSeverity">
  <option value="Minimal/None">Minimal/None (0–4)</option>
  <option value="Mild">Mild (5–9)</option>
  <option value="Moderate">Moderate (10–14)</option>
  <option value="Moderately Severe">Moderately Severe (15–19)</option>
  <option value="Severe">Severe (20–27)</option>
</select>
</div>

<div id="gad" class="tab">
<label>Patient Name:</label><input type="text" id="gadName">
<label>Age:</label><input type="number" id="gadAge" min="0" max="120">
<label>GAD-7 Score:</label><input type="number" id="gadScore" min="0" max="21">
<label class="small">Auto severity updates</label>
<select id="gadSeverity">
  <option value="Mild">Mild (0–5)</option>
  <option value="Moderate">Moderate (6–10)</option>
  <option value="Severe">Severe (11–21)</option>
</select>
</div>

<label>Provider (Name & Credentials):</label><input type="text" id="provider">

<label>Patient Report:</label><textarea id="patientReport" rows="3"></textarea>
<label>Plan:</label><textarea id="plan" rows="3"></textarea>

<button onclick="generatePDF()">Generate PDF</button>

<div id="output"></div>
</div>

<script>
// Users and passwords
const users = { "nmccgsuh":"15358", "mjohn":"mj15358", "psych":"psych" };
const providerNames = { "nmccgsuh":"Dr. Nicolas McCarthy MD PhD FACS", "mjohn":"Dr. Martha Johnson DO" };

// Login
function login(){
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value.trim();
  if(users[u] && users[u]===p){
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("mainDiv").style.display="block";
    document.getElementById("provider").value = providerNames[u] || "";
  } else {
    alert("Invalid credentials");
  }
}

// Tabs
function showTab(tab){
  document.querySelectorAll('.tab').forEach(d=>d.style.display='none');
  document.getElementById(tab).style.display='block';
}

// PHQ Severity
document.getElementById("phqScore").addEventListener("input",()=>{
  const val=Number(document.getElementById("phqScore").value);
  let sev="";
  if(val<=4) sev="Minimal/None";
  else if(val<=9) sev="Mild";
  else if(val<=14) sev="Moderate";
  else if(val<=19) sev="Moderately Severe";
  else sev="Severe";
  const sel=document.getElementById("phqSeverity");
  for(let i=0;i<sel.options.length;i++){if(sel.options[i].value===sev){sel.selectedIndex=i;break;}}
});

// GAD Severity
document.getElementById("gadScore").addEventListener("input",()=>{
  const val=Number(document.getElementById("gadScore").value);
  let sev="";
  if(val<=5) sev="Mild";
  else if(val<=10) sev="Moderate";
  else sev="Severe";
  const sel=document.getElementById("gadSeverity");
  for(let i=0;i<sel.options.length;i++){if(sel.options[i].value===sev){sel.selectedIndex=i;break;}}
});

// PDF generation
function generatePDF(){
  const doc = new jsPDF();
  // Determine which tab is active
  const activeTab = document.querySelector('.tab[style*="block"]');
  const isPHQ = activeTab.id==="phq";
  const name = isPHQ ? document.getElementById("phqName").value || "[Name]" : document.getElementById("gadName").value || "[Name]";
  const age = isPHQ ? document.getElementById("phqAge").value || "[Age]" : document.getElementById("gadAge").value || "[Age]";
  const score = isPHQ ? document.getElementById("phqScore").value || "[Score]" : document.getElementById("gadScore").value || "[Score]";
  const severity = isPHQ ? document.getElementById("phqSeverity").value : document.getElementById("gadSeverity").value;
  const provider = document.getElementById("provider").value || "[Provider]";
  const report = document.getElementById("patientReport").value || "[Report]";
  const plan = document.getElementById("plan").value || "[Plan]";

  const note=`Patient: ${name}\nAge: ${age}\nProvider: ${provider}\n\n${isPHQ?"PHQ-9-A":"GAD-7"}: ${score} (${severity})\n\nPatient Report:\n${report}\n\nPlan:\n${plan}`;
  
  let y=10;
  note.split("\n").forEach(line=>{doc.text(10,y,line); y+=7;});
  const safeName=name.replace(/[^a-z0-9_\-]/gi,"_").slice(0,40)||"patient";
  doc.save(`${isPHQ?"PHQ":"GAD"}_Note_${safeName}.pdf`);
  document.getElementById("output").textContent=note;
}

// Initialize first tab
showTab('phq');
</script>

</body>
</html>
